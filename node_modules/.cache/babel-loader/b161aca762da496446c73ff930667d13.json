{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\Alika\\\\Desktop\\\\VCH_APP\\\\src\\\\containers\\\\TrialQ.js\";\nimport React, { Component } from 'react';\nimport './Trial.css';\nimport { Redirect } from \"react-router-dom\";\nimport { createStim, createGabor } from \"../Stim.js\";\nimport { QuestCreate, QuestRecompute, QuestTrials, QuestUpdate, QuestStimulate, QuestMean, QuestMode, QuestSd, QuestP, QuestPdf, QuestQuantile, PAL_Gumbel } from \"../Quest.js\";\nimport { connect } from 'react-redux';\nimport { add_array as _add_array, add_response_1 as _add_response_, add_response_time_1 as _add_response_time_, add_contrast_1 as _add_contrast_ } from '../actions/data';\n\nvar TrialQ =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(TrialQ, _Component);\n\n  function TrialQ(props) {\n    var _this;\n\n    _classCallCheck(this, TrialQ);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TrialQ).call(this, props));\n    _this.keyFunction = _this.keyFunction.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.create_noise = _this.create_noise.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.state = {\n      continue: false,\n      counter: 0,\n      counter2: 0,\n      change: false,\n      responses_1: [],\n      contrast_array_1: [],\n      response_time_1: [],\n      ratings_1: [],\n      responses_2: [],\n      contrast_array_2: [],\n      response_time_2: [],\n      ratings_2: [],\n      time_window: false,\n      time_window_start: 0,\n      time_window_rating: false,\n      limit: 100,\n      currentQ: 1 //1 for contrast 1 and 2 for contrast 2\n\n    };\n    _this.canvasRef = React.createRef();\n    _this.audioContext = new AudioContext();\n    return _this;\n  }\n\n  _createClass(TrialQ, [{\n    key: \"create_noise\",\n    value: function create_noise(audioContext, callback) {\n      var end = 80; // var contrast_block = tt1;\n\n      var index1 = 0;\n      var index2 = 0;\n      var total = 0; //train_test arrays\n\n      var tt1 = [0, .5, 1, 0, .5, 1, 0, .5, 1, 0, .5, 1];\n      var end = tt1.length;\n      var contrast_block = tt1;\n\n      var SimplexNoise = require('simplex-noise');\n\n      var simplex = new SimplexNoise(),\n          canvas = document.getElementById('c'),\n          ctx = canvas.getContext('2d'),\n          imgdata = ctx.getImageData(0, 0, canvas.width, canvas.height),\n          data = imgdata.data,\n          t = 0; //initializing QUEST\n\n      var tGuess = 0.5,\n          tGuessSd = 0.1,\n          pThreshold = 0.75,\n          beta = 3.5,\n          delta = 0.01,\n          gamma = 0.01,\n          grain = 0.001,\n          dim = 1000,\n          range = 20;\n      var q_1 = QuestCreate(tGuess, tGuessSd, pThreshold, beta, delta, gamma, grain, range);\n      var q_2 = QuestCreate(tGuess, tGuessSd, pThreshold, beta, delta, gamma, grain, range);\n      var stim = createStim();\n      var stimulus_blank = createGabor(stim, 0);\n      var stimulus;\n      var jitter = Math.floor(Math.random() * 20); //jitter tone presentation 0-500ms per trial\n\n      var start_time = 100;\n      var contrast = 0;\n      var intervalId = undefined;\n      var that = this;\n      var seconds = 0;\n\n      function generate_noise() {\n        return _generate_noise.apply(this, arguments);\n      }\n\n      function _generate_noise() {\n        _generate_noise = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          var seconds, x, y, r, recWidth, recHeight, xPos, yPos, img;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (t == start_time + jitter) {\n                    index1 = that.state.counter;\n                    index2 = that.state.counter2;\n                    total = index1 + index2; // determining which staircase to use\n\n                    if (index1 == index2) {\n                      that.setState({\n                        //current staircase is 1\n                        currentQ: 1\n                      });\n                    }\n\n                    if (index1 != index2) {\n                      index2++;\n                      that.setState({\n                        //current staircase is 2\n                        currentQ: 2\n                      });\n                    }\n\n                    if (that.state.current_q == 1) {\n                      if (index1 = 0) {\n                        contrast = tGuess + .3;\n                      } else {\n                        contrast = QuestQuantile(q_1);\n                      }\n                    }\n\n                    if (that.state.current_q == 2) {\n                      if (index2 = 0) {\n                        contrast = tGuess - 0.3;\n                      } else {\n                        contrast = QuestQuantile(q_2);\n                      }\n                    }\n\n                    console.log(contrast);\n                    seconds = new Date().getTime() / 1000;\n                    console.log(\"time on \", seconds);\n                    that.setState({\n                      time_window: true,\n                      time_window_rating: true,\n                      time_window_start: seconds\n                    });\n                    console.log(that.state.responses_1, that.state.ratings_1, that.state.response_time_1, that.state.contrast_array_1);\n                    stimulus = createGabor(stim, contrast);\n                    beep(50, 830, 300, audioContext); //beep for arg3 miliseconds\n                  }\n\n                  for (x = 0; x < 256; x++) {\n                    for (y = 0; y < 256; y++) {\n                      if (t == start_time + jitter || t == start_time + jitter + 1 || t == start_time + jitter + 2 || t == start_time + jitter + 3 || t == start_time + jitter + 4 || t == start_time + jitter + 5 || t == start_time + jitter + 6 || t == start_time + jitter + 7 || t == start_time + jitter + 8 || t == start_time + jitter + 9 || t == start_time + jitter + 10 || t == start_time + jitter + 11 || t == start_time + jitter + 12 || t == start_time + jitter + 13 || t == start_time + jitter + 14 || t == start_time + jitter + 15 || t == start_time + jitter + 16 || t == start_time + jitter + 17 || t == start_time + jitter + 18 || t == start_time + jitter + 19 || t == start_time + jitter + 20 || t == start_time + jitter + 21 || t == start_time + jitter + 22 || t == start_time + jitter + 23 || t == start_time + jitter + 24 || t == start_time + jitter + 25 || t == start_time + jitter + 26 || t == start_time + jitter + 27 || t == start_time + jitter + 28 || t == start_time + jitter + 29 || t == start_time + jitter + 30) {\n                        if (t == start_time + jitter + 30) {\n                          t = 0; //during beep show signal, then reset timer to 0\n                        }\n\n                        r = simplex.noise3D(x / 8, y / 8, t / 8) * 0.4 + 0.35;\n                        data[(x + y * 256) * 4 + 0] = stim.alpha * stimulus[(x + y * 256) * 4 + 0] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 1] = stim.alpha * stimulus[(x + y * 256) * 4 + 1] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 2] = stim.alpha * stimulus[(x + y * 256) * 4 + 2] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 3] = 255;\n                      } else {\n                        seconds = new Date().getTime() / 1000;\n\n                        if (that.state.time_window_start + 2 == seconds) {\n                          that.setState({\n                            time_window: false,\n                            time_window_rating: false\n                          });\n\n                          if (that.state.currentQ == 1) {\n                            if (that.state.contrast_array_1.length < that.state.responses_1.length) {\n                              that.setState({\n                                contrast_array_1: that.state.contrast_array_1.concat([contrast])\n                              });\n                              that.setState({\n                                change: true\n                              });\n                            }\n\n                            if (that.state.responses_1.length != that.state.ratings_1.length) {\n                              if (that.state.responses_1.length > that.state.ratings_1.length) {\n                                console.log(\"response and response time discarded\", that.state.responses_1, that.state.response_time_1, that.state.ratings_1, that.state.contrast_array_1);\n                                that.setState({\n                                  responses_1: that.state.responses_1.slice(0, that.state.ratings_1.length),\n                                  response_time_1: that.state.response_time_1.slice(0, that.state.ratings_1.length),\n                                  counter: that.state.counter - 1,\n                                  contrast_array_1: that.state.contrast_array_1.slice(0, that.state.ratings_1.length)\n                                });\n                              } else {\n                                console.log(\"rating discarded\", that.state.responses_1, that.state.ratings_1, that.state.contrast_array_1);\n                                that.setState({\n                                  ratings_1: that.state.ratings_1.slice(0, that.state.responses_1.length)\n                                });\n                              }\n                            }\n                          }\n\n                          if (that.state.currentQ == 2) {\n                            if (that.state.contrast_array_2.length < that.state.responses_2.length) {\n                              that.setState({\n                                contrast_array_2: that.state.contrast_array_2.concat([contrast])\n                              });\n                              that.setState({\n                                change: true\n                              });\n                            }\n\n                            if (that.state.responses_2.length != that.state.ratings_2.length) {\n                              if (that.state.responses_2.length > that.state.ratings_2.length) {\n                                console.log(\"response and response time discarded\", that.state.responses_2, that.state.response_time_2, that.state.ratings_2, that.state.contrast_array_2);\n                                that.setState({\n                                  responses_2: that.state.responses_2.slice(0, that.state.ratings_2.length),\n                                  response_time_2: that.state.response_time_2.slice(0, that.state.ratings_2.length),\n                                  counter: that.state.counter - 1,\n                                  contrast_array_2: that.state.contrast_array_2.slice(0, that.state.ratings_2.length)\n                                });\n                              } else {\n                                console.log(\"rating discarded\", that.state.responses_1, that.state.ratings_1, that.state.contrast_array_1);\n                                that.setState({\n                                  ratings_1: that.state.ratings_1.slice(0, that.state.responses_1.length)\n                                });\n                              }\n                            }\n                          }\n\n                          console.log(\"time off \", seconds);\n                        }\n\n                        r = simplex.noise3D(x / 8, y / 8, t / 8) * 0.4 + 0.35;\n                        data[(x + y * 256) * 4 + 0] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 0] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 1] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 1] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 2] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 2] + (1 - stim.alpha) * r * 250;\n                        data[(x + y * 256) * 4 + 3] = 255; //if there is no beep, show blank signal\n                      }\n                    }\n                  }\n\n                  t++;\n                  ctx.putImageData(imgdata, 0, 0);\n                  recWidth = canvas.width / 8;\n                  recHeight = canvas.height / 8;\n                  xPos = canvas.width / 2 - recWidth / 2;\n                  yPos = canvas.height / 2 - recHeight / 2;\n                  img = new Image();\n                  img.src = \"https://www.shareicon.net/data/256x256/2015/12/04/682310_cross_512x512.png\";\n                  ctx.fillStyle = \"gray\";\n                  ctx.fillRect(xPos, yPos, recWidth, recHeight);\n                  ctx.drawImage(img, xPos, yPos, recWidth, recHeight);\n\n                  if (!(total == end)) {\n                    _context.next = 18;\n                    break;\n                  }\n\n                  window.cancelAnimationFrame(intervalId);\n                  that.audioContext.close();\n                  that.setState({\n                    continue: true\n                  });\n                  return _context.abrupt(\"return\");\n\n                case 18:\n                  if (total < end) {\n                    intervalId = window.requestAnimationFrame(generate_noise); //console.log(that.state.contrast_array_1, that.state.responses_1);\n\n                    if (that.state.current_q == 1 && that.state.change == true) {\n                      q_1 = QuestUpdate(q_1, [that.state.contrast_array_1[that.state.contrast_array_1.length - 1]], [that.state.responses_1[that.state.responses_1.length - 1]]);\n                      console.log(QuestQuantile(q_1));\n                      that.setState({\n                        change: false\n                      });\n                    }\n\n                    if (that.state.current_q == 2 && that.state.change == true) {\n                      q_2 = QuestUpdate(q_2, that.state.contrast_array_1[that.state.contrast_array_1.length - 1], that.state.responses_1[that.state.responses_1.length - 1]);\n                      that.setState({\n                        change: false\n                      });\n                    }\n                  }\n\n                case 19:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n        return _generate_noise.apply(this, arguments);\n      }\n\n      generate_noise.call(that);\n    }\n  }, {\n    key: \"keyFunction\",\n    value: function keyFunction(event) {\n      var seconds = new Date().getTime() / 1000;\n\n      if (event.keyCode === 81 && this.state.time_window == true && this.state.currentQ == 1) {\n        // Set setState\n        this.setState({\n          counter: this.state.counter + 1,\n          responses_1: this.state.responses_1.concat([1]),\n          response_time_1: this.state.response_time_1.concat([seconds - this.state.time_window_start]),\n          time_window: false\n        });\n\n        if (this.state.counter == this.state.limit) {\n          this.setState({\n            continue: true\n          });\n        }\n      }\n\n      if (event.keyCode === 81 && this.state.time_window == true && this.state.currentQ == 2) {\n        // Set setState\n        this.setState({\n          counter: this.state.counter2 + 1,\n          responses_2: this.state.responses_2.concat([1]),\n          response_time_2: this.state.response_time_2.concat([seconds - this.state.time_window_start]),\n          time_window: false\n        });\n\n        if (this.state.counter == this.state.limit) {\n          this.setState({\n            continue: true\n          });\n        }\n      }\n\n      if (event.keyCode === 69 && this.state.time_window == true && this.state.currentQ == 1) {\n        this.setState({\n          counter: this.state.counter + 1,\n          responses_1: this.state.responses_1.concat([0]),\n          response_time_1: this.state.response_time_1.concat([seconds - this.state.time_window_start]),\n          time_window: false\n        });\n\n        if (this.state.counter == this.state.limit) {\n          this.setState({\n            continue: true\n          });\n        }\n      }\n\n      if (event.keyCode === 69 && this.state.time_window == true && this.state.currentQ == 2) {\n        this.setState({\n          counter: this.state.counter2 + 1,\n          responses_2: this.state.responses_2.concat([0]),\n          response_time_2: this.state.response_time_2.concat([seconds - this.state.time_window_start]),\n          time_window: false\n        });\n\n        if (this.state.counter == this.state.limit) {\n          this.setState({\n            continue: true\n          });\n        }\n      }\n\n      if ((event.keyCode === 49 || event.keyCode === 50 || event.keyCode === 51 || event.keyCode === 52 || event.keyCode === 53) && this.state.time_window_rating == true) {\n        this.setState({\n          ratings_1: this.state.ratings_1.concat([event.keyCode - 48]),\n          time_window_rating: false\n        });\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener(\"keydown\", this.keyFunction, false);\n\n      if (this.state.continue == false) {\n        this.create_noise(this.audioContext);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"keydown\", this.keyFunction, false);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.continue == true) {\n        alert(\"Trial completed\");\n        return React.createElement(Redirect, {\n          to: \"/Complete\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 388\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"Trial\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 392\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"hidden\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393\n        },\n        __self: this\n      }), React.createElement(\"header\", {\n        className: \"Trial-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 394\n        },\n        __self: this\n      }, React.createElement(\"canvas\", {\n        id: \"c\",\n        width: \"256\",\n        height: \"256\",\n        style: {\n          zIndex: \"0\",\n          position: \"fixed\",\n          left: \"25%\",\n          width: '50%',\n          height: 'auto'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 395\n        },\n        __self: this\n      }), React.createElement(\"canvas\", {\n        id: \"c2\",\n        width: \"256\",\n        height: \"256\",\n        style: {\n          zIndex: \"1\",\n          position: \"fixed\",\n          left: \"25%\",\n          width: '50%',\n          height: 'auto'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 397\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return TrialQ;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    data: state.data\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    add_response_1: function add_response_1(element) {\n      return dispatch(_add_response_(element));\n    },\n    add_response_time_1: function add_response_time_1(element) {\n      return dispatch(_add_response_time_(element));\n    },\n    add_contrast_1: function add_contrast_1(element) {\n      return dispatch(_add_contrast_(element));\n    },\n    add_array: function add_array(arr) {\n      return dispatch(_add_array(arr));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TrialQ);\n\nfunction beep(amp, freq, ms, audioContext) {\n  //amp:0..100, freq in Hz, ms\n  if (!audioContext) return;\n  var osc = audioContext.createOscillator();\n  var gain = audioContext.createGain();\n  osc.connect(gain);\n  osc.value = freq;\n  gain.connect(audioContext.destination);\n  gain.gain.value = amp / 100;\n  osc.start(audioContext.currentTime);\n  osc.stop(audioContext.currentTime + ms / 1000);\n} //array shuffling function, used to randomize order of presentation for different blocks\n\n\nfunction shuffle(array) {\n  var i = 0;\n  var j = 0;\n  var temp = null;\n\n  for (i = array.length - 1; i > 0; i -= 1) {\n    j = Math.floor(Math.random() * (i + 1));\n    temp = array[i];\n    array[i] = array[j];\n    array[j] = temp;\n  }\n}","map":{"version":3,"sources":["C:\\Users\\Alika\\Desktop\\VCH_APP\\src\\containers\\TrialQ.js"],"names":["React","Component","Redirect","createStim","createGabor","QuestCreate","QuestRecompute","QuestTrials","QuestUpdate","QuestStimulate","QuestMean","QuestMode","QuestSd","QuestP","QuestPdf","QuestQuantile","PAL_Gumbel","connect","add_array","add_response_1","add_response_time_1","add_contrast_1","TrialQ","props","keyFunction","bind","create_noise","state","continue","counter","counter2","change","responses_1","contrast_array_1","response_time_1","ratings_1","responses_2","contrast_array_2","response_time_2","ratings_2","time_window","time_window_start","time_window_rating","limit","currentQ","canvasRef","createRef","audioContext","AudioContext","callback","end","index1","index2","total","tt1","length","contrast_block","SimplexNoise","require","simplex","canvas","document","getElementById","ctx","getContext","imgdata","getImageData","width","height","data","t","tGuess","tGuessSd","pThreshold","beta","delta","gamma","grain","dim","range","q_1","q_2","stim","stimulus_blank","stimulus","jitter","Math","floor","random","start_time","contrast","intervalId","undefined","that","seconds","generate_noise","setState","current_q","console","log","Date","getTime","beep","x","y","r","noise3D","alpha","concat","slice","putImageData","recWidth","recHeight","xPos","yPos","img","Image","src","fillStyle","fillRect","drawImage","window","cancelAnimationFrame","close","requestAnimationFrame","call","event","keyCode","addEventListener","removeEventListener","alert","zIndex","position","left","mapStateToProps","mapDispatchToProps","dispatch","element","arr","amp","freq","ms","osc","createOscillator","gain","createGain","value","destination","start","currentTime","stop","shuffle","array","i","j","temp"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport './Trial.css';\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { createStim, createGabor } from \"../Stim.js\"\r\nimport { QuestCreate, QuestRecompute, QuestTrials, QuestUpdate, QuestStimulate, QuestMean, QuestMode, QuestSd, QuestP, QuestPdf, QuestQuantile, PAL_Gumbel } from \"../Quest.js\"\r\n\r\nimport { connect } from 'react-redux'\r\nimport { add_array, add_response_1, add_response_time_1, add_contrast_1 } from '../actions/data'\r\n\r\nclass TrialQ extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.keyFunction = this.keyFunction.bind(this);\r\n    this.create_noise = this.create_noise.bind(this);\r\n    this.state = {\r\n      continue: false,\r\n      counter: 0,\r\n      counter2: 0,\r\n      change: false,\r\n\r\n      responses_1: [],\r\n      contrast_array_1: [],\r\n      response_time_1: [],\r\n      ratings_1: [],\r\n\r\n      responses_2: [],\r\n      contrast_array_2: [],\r\n      response_time_2: [],\r\n      ratings_2: [],\r\n\r\n      time_window: false,\r\n      time_window_start: 0,\r\n      time_window_rating: false,\r\n      limit: 100,\r\n\r\n\r\n      currentQ: 1, //1 for contrast 1 and 2 for contrast 2\r\n\r\n    }\r\n    this.canvasRef = React.createRef();\r\n    this.audioContext = new AudioContext();\r\n  }\r\n\r\n  create_noise(audioContext, callback) {\r\n\r\n    var end = 80;\r\n    // var contrast_block = tt1;\r\n    var index1 = 0;\r\n    var index2 = 0;\r\n    var total = 0;\r\n\r\n    //train_test arrays\r\n    var tt1 = [0, .5, 1, 0, .5, 1, 0, .5, 1, 0, .5, 1];\r\n    var end = tt1.length;\r\n    var contrast_block = tt1;\r\n\r\n    var SimplexNoise = require('simplex-noise');\r\n\r\n    var simplex = new SimplexNoise(),\r\n      canvas = document.getElementById('c'),\r\n      ctx = canvas.getContext('2d'),\r\n      imgdata = ctx.getImageData(0, 0, canvas.width, canvas.height),\r\n      data = imgdata.data,\r\n      t = 0;\r\n\r\n    //initializing QUEST\r\n    var tGuess = 0.5,\r\n      tGuessSd = 0.1,\r\n      pThreshold = 0.75,\r\n      beta = 3.5,\r\n      delta = 0.01,\r\n      gamma = 0.01,\r\n      grain = 0.001,\r\n      dim = 1000,\r\n      range = 20;\r\n    var q_1 = QuestCreate(tGuess, tGuessSd, pThreshold, beta, delta, gamma, grain, range);\r\n    var q_2 = QuestCreate(tGuess, tGuessSd, pThreshold, beta, delta, gamma, grain, range);\r\n\r\n    var stim = createStim();\r\n    var stimulus_blank = createGabor(stim, 0);\r\n\r\n    var stimulus;\r\n    var jitter = Math.floor(Math.random() * 20); //jitter tone presentation 0-500ms per trial\r\n    var start_time = 100;\r\n    var contrast = 0;\r\n    var intervalId = undefined;\r\n\r\n    var that = this;\r\n    var seconds = 0;\r\n\r\n    async function generate_noise() {\r\n\r\n      if (t == start_time + jitter) {\r\n\r\n        index1 = that.state.counter;\r\n        index2 = that.state.counter2;\r\n\r\n        total = index1 + index2;\r\n\r\n        // determining which staircase to use\r\n        if (index1 == index2) {\r\n          that.setState({             //current staircase is 1\r\n            currentQ: 1,\r\n          });\r\n        }\r\n        if (index1 != index2) {\r\n          index2++;\r\n          that.setState({             //current staircase is 2\r\n            currentQ: 2,\r\n          });\r\n        }\r\n        if (that.state.current_q == 1) {\r\n          if (index1 = 0) {\r\n            contrast = tGuess + .3;\r\n          }\r\n          else {\r\n            contrast = QuestQuantile(q_1);\r\n          }\r\n        }\r\n        if (that.state.current_q == 2) {\r\n          if (index2 = 0) {\r\n            contrast = tGuess - 0.3;\r\n          }\r\n          else {\r\n            contrast = QuestQuantile(q_2);\r\n          }\r\n        }\r\n\r\n        console.log(contrast);\r\n\r\n        var seconds = new Date().getTime() / 1000;\r\n\r\n        console.log(\"time on \", seconds);\r\n\r\n        that.setState({\r\n          time_window: true,\r\n          time_window_rating: true,\r\n          time_window_start: seconds,\r\n        });\r\n\r\n        console.log(that.state.responses_1, that.state.ratings_1, that.state.response_time_1, that.state.contrast_array_1);\r\n\r\n        stimulus = createGabor(stim, contrast);\r\n        beep(50, 830, 300, audioContext); //beep for arg3 miliseconds\r\n      }\r\n\r\n      for (var x = 0; x < 256; x++) {\r\n        for (var y = 0; y < 256; y++) {\r\n          if (t == start_time + jitter || t == start_time + jitter + 1 || t == start_time + jitter + 2 || t == start_time + jitter + 3 || t == start_time + jitter + 4\r\n            || t == start_time + jitter + 5 || t == start_time + jitter + 6 || t == start_time + jitter + 7 || t == start_time + jitter + 8 || t == start_time + jitter + 9\r\n            || t == start_time + jitter + 10 || t == start_time + jitter + 11 || t == start_time + jitter + 12 || t == start_time + jitter + 13 || t == start_time + jitter + 14\r\n            || t == start_time + jitter + 15 || t == start_time + jitter + 16 || t == start_time + jitter + 17 || t == start_time + jitter + 18 || t == start_time + jitter + 19\r\n            || t == start_time + jitter + 20 || t == start_time + jitter + 21 || t == start_time + jitter + 22 || t == start_time + jitter + 23 || t == start_time + jitter + 24\r\n            || t == start_time + jitter + 25 || t == start_time + jitter + 26 || t == start_time + jitter + 27 || t == start_time + jitter + 28 || t == start_time + jitter + 29\r\n            || t == start_time + jitter + 30) {\r\n            if (t == start_time + jitter + 30) {\r\n              t = 0;\r\n              //during beep show signal, then reset timer to 0\r\n            }\r\n\r\n            var r = simplex.noise3D(x / 8, y / 8, t / 8) * 0.4 + 0.35;\r\n            data[(x + y * 256) * 4 + 0] = stim.alpha * stimulus[(x + y * 256) * 4 + 0] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 1] = stim.alpha * stimulus[(x + y * 256) * 4 + 1] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 2] = stim.alpha * stimulus[(x + y * 256) * 4 + 2] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 3] = 255;\r\n          }\r\n\r\n          else {\r\n\r\n            seconds = new Date().getTime() / 1000\r\n\r\n            if (that.state.time_window_start + 2 == seconds) {\r\n              that.setState({\r\n                time_window: false,\r\n                time_window_rating: false,\r\n              });\r\n\r\n              if (that.state.currentQ == 1) {\r\n\r\n                if (that.state.contrast_array_1.length < that.state.responses_1.length) {\r\n                  that.setState({ contrast_array_1: that.state.contrast_array_1.concat([contrast]) });\r\n                  that.setState({ change: true });\r\n                }\r\n\r\n                if (that.state.responses_1.length != that.state.ratings_1.length) {\r\n\r\n                  if (that.state.responses_1.length > that.state.ratings_1.length) {\r\n\r\n                    console.log(\"response and response time discarded\", that.state.responses_1, that.state.response_time_1, that.state.ratings_1, that.state.contrast_array_1);\r\n\r\n                    that.setState({\r\n                      responses_1: that.state.responses_1.slice(0, that.state.ratings_1.length),\r\n                      response_time_1: that.state.response_time_1.slice(0, that.state.ratings_1.length),\r\n                      counter: that.state.counter - 1,\r\n                      contrast_array_1: that.state.contrast_array_1.slice(0, that.state.ratings_1.length)\r\n                    });\r\n                  }\r\n\r\n                  else {\r\n                    console.log(\"rating discarded\", that.state.responses_1, that.state.ratings_1, that.state.contrast_array_1);\r\n\r\n                    that.setState({\r\n                      ratings_1: that.state.ratings_1.slice(0, that.state.responses_1.length),\r\n                    });\r\n                  }\r\n                }\r\n              }\r\n\r\n              if (that.state.currentQ == 2) {\r\n\r\n                if (that.state.contrast_array_2.length < that.state.responses_2.length) {\r\n                  that.setState({ contrast_array_2: that.state.contrast_array_2.concat([contrast]) });\r\n                  that.setState({ change: true });\r\n                }\r\n\r\n                if (that.state.responses_2.length != that.state.ratings_2.length) {\r\n\r\n                  if (that.state.responses_2.length > that.state.ratings_2.length) {\r\n\r\n                    console.log(\"response and response time discarded\", that.state.responses_2, that.state.response_time_2, that.state.ratings_2, that.state.contrast_array_2);\r\n\r\n                    that.setState({\r\n                      responses_2: that.state.responses_2.slice(0, that.state.ratings_2.length),\r\n                      response_time_2: that.state.response_time_2.slice(0, that.state.ratings_2.length),\r\n                      counter: that.state.counter - 1,\r\n                      contrast_array_2: that.state.contrast_array_2.slice(0, that.state.ratings_2.length)\r\n                    });\r\n                  }\r\n\r\n                  else {\r\n                    console.log(\"rating discarded\", that.state.responses_1, that.state.ratings_1, that.state.contrast_array_1);\r\n\r\n                    that.setState({\r\n                      ratings_1: that.state.ratings_1.slice(0, that.state.responses_1.length),\r\n                    });\r\n                  }\r\n                }\r\n              }\r\n\r\n\r\n\r\n              console.log(\"time off \", seconds);\r\n            }\r\n\r\n\r\n            var r = simplex.noise3D(x / 8, y / 8, t / 8) * 0.4 + 0.35;\r\n            data[(x + y * 256) * 4 + 0] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 0] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 1] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 1] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 2] = stim.alpha * stimulus_blank[(x + y * 256) * 4 + 2] + (1 - stim.alpha) * r * 250;\r\n            data[(x + y * 256) * 4 + 3] = 255;\r\n            //if there is no beep, show blank signal\r\n          }\r\n        }\r\n      }\r\n\r\n      t++;\r\n      ctx.putImageData(imgdata, 0, 0);\r\n\r\n      var recWidth = canvas.width / 8;\r\n      var recHeight = canvas.height / 8;\r\n\r\n      var xPos = (canvas.width / 2) - (recWidth / 2);\r\n\r\n      var yPos = (canvas.height / 2) - (recHeight / 2);\r\n      var img = new Image();\r\n      img.src = \"https://www.shareicon.net/data/256x256/2015/12/04/682310_cross_512x512.png\";\r\n      ctx.fillStyle = \"gray\";\r\n\r\n      ctx.fillRect(xPos, yPos, recWidth, recHeight);\r\n      ctx.drawImage(img, xPos, yPos, recWidth, recHeight);\r\n\r\n      if (total == end) {\r\n        window.cancelAnimationFrame(intervalId);\r\n        that.audioContext.close();\r\n        that.setState({ continue: true });\r\n        return;\r\n      }\r\n\r\n      if (total < end) {\r\n        intervalId = window.requestAnimationFrame(generate_noise);\r\n\r\n        //console.log(that.state.contrast_array_1, that.state.responses_1);\r\n\r\n        if (that.state.current_q == 1 && that.state.change == true) {\r\n\r\n          q_1 = QuestUpdate(q_1, [that.state.contrast_array_1[that.state.contrast_array_1.length - 1]], [that.state.responses_1[that.state.responses_1.length - 1]]);\r\n          console.log(QuestQuantile(q_1));\r\n          that.setState({ change: false });\r\n        }\r\n\r\n        if (that.state.current_q == 2 && that.state.change == true) {\r\n          q_2 = QuestUpdate(q_2, that.state.contrast_array_1[that.state.contrast_array_1.length - 1], that.state.responses_1[that.state.responses_1.length - 1]);\r\n          that.setState({ change: false });\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    generate_noise.call(that);\r\n\r\n  }\r\n\r\n  keyFunction(event) {\r\n    var seconds = new Date().getTime() / 1000\r\n\r\n    if (event.keyCode === 81 && this.state.time_window == true && this.state.currentQ == 1) {\r\n\r\n      // Set setState\r\n      this.setState({\r\n        counter: this.state.counter + 1,\r\n        responses_1: this.state.responses_1.concat([1]),\r\n        response_time_1: this.state.response_time_1.concat([seconds - this.state.time_window_start]),\r\n        time_window: false,\r\n      });\r\n\r\n      if (this.state.counter == this.state.limit) {\r\n        this.setState({ continue: true });\r\n      }\r\n\r\n    }\r\n\r\n    if (event.keyCode === 81 && this.state.time_window == true && this.state.currentQ == 2) {\r\n\r\n      // Set setState\r\n      this.setState({\r\n        counter: this.state.counter2 + 1,\r\n        responses_2: this.state.responses_2.concat([1]),\r\n        response_time_2: this.state.response_time_2.concat([seconds - this.state.time_window_start]),\r\n        time_window: false,\r\n      });\r\n\r\n      if (this.state.counter == this.state.limit) {\r\n        this.setState({ continue: true });\r\n      }\r\n\r\n    }\r\n\r\n    if (event.keyCode === 69 && this.state.time_window == true && this.state.currentQ == 1) {\r\n      this.setState({\r\n        counter: this.state.counter + 1,\r\n        responses_1: this.state.responses_1.concat([0]),\r\n        response_time_1: this.state.response_time_1.concat([seconds - this.state.time_window_start]),\r\n        time_window: false,\r\n      });\r\n\r\n      if (this.state.counter == this.state.limit) {\r\n        this.setState({ continue: true });\r\n      }\r\n    }\r\n\r\n    if (event.keyCode === 69 && this.state.time_window == true && this.state.currentQ == 2) {\r\n      this.setState({\r\n        counter: this.state.counter2 + 1,\r\n        responses_2: this.state.responses_2.concat([0]),\r\n        response_time_2: this.state.response_time_2.concat([seconds - this.state.time_window_start]),\r\n        time_window: false,\r\n      });\r\n\r\n      if (this.state.counter == this.state.limit) {\r\n        this.setState({ continue: true });\r\n      }\r\n    }\r\n\r\n\r\n    if ((event.keyCode === 49 || event.keyCode === 50 || event.keyCode === 51 || event.keyCode === 52 || event.keyCode === 53) && this.state.time_window_rating == true) {\r\n      this.setState({\r\n        ratings_1: this.state.ratings_1.concat([event.keyCode - 48]),\r\n        time_window_rating: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"keydown\", this.keyFunction, false);\r\n    if (this.state.continue == false) {\r\n      this.create_noise(this.audioContext);\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.keyFunction, false);\r\n  }\r\n\r\n  render() {\r\n\r\n    if (this.state.continue == true) {\r\n      alert(\"Trial completed\")\r\n      return <Redirect to=\"/Complete\" />\r\n    }\r\n\r\n    return (\r\n      <div className=\"Trial\">\r\n        <input type=\"hidden\" />\r\n        <header className=\"Trial-header\">\r\n          <canvas id=\"c\" width=\"256\" height=\"256\"\r\n            style={{ zIndex: \"0\", position: \"fixed\", left: \"25%\", width: '50%', height: 'auto' }}></canvas>\r\n          <canvas id=\"c2\" width=\"256\" height=\"256\"\r\n            style={{ zIndex: \"1\", position: \"fixed\", left: \"25%\", width: '50%', height: 'auto' }}></canvas>\r\n        </header>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  data: state.data,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  add_response_1: (element) => dispatch(add_response_1(element)),\r\n  add_response_time_1: (element) => dispatch(add_response_time_1(element)),\r\n  add_contrast_1: (element) => dispatch(add_contrast_1(element)),\r\n  add_array: (arr) => dispatch(add_array(arr)),\r\n})\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TrialQ);\r\n\r\n\r\nfunction beep(amp, freq, ms, audioContext) {//amp:0..100, freq in Hz, ms\r\n  if (!audioContext) return;\r\n  var osc = audioContext.createOscillator();\r\n  var gain = audioContext.createGain();\r\n  osc.connect(gain);\r\n  osc.value = freq;\r\n  gain.connect(audioContext.destination);\r\n  gain.gain.value = amp / 100;\r\n  osc.start(audioContext.currentTime);\r\n  osc.stop(audioContext.currentTime + ms / 1000);\r\n}\r\n\r\n//array shuffling function, used to randomize order of presentation for different blocks\r\nfunction shuffle(array) {\r\n  var i = 0\r\n  var j = 0\r\n  var temp = null\r\n\r\n  for (i = array.length - 1; i > 0; i -= 1) {\r\n    j = Math.floor(Math.random() * (i + 1))\r\n    temp = array[i]\r\n    array[i] = array[j]\r\n    array[j] = temp\r\n  }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}